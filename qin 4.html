<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Qin Kingdom Decision Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0b0c10;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .stats {
      display: flex;
      width: 100%;
      max-width: 480px;
      justify-content: space-between;
      padding: 10px 16px;
      box-sizing: border-box;
      background: #15171f;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .stat {
      flex: 1;
      margin: 0 4px;
      font-size: 12px;
      text-align: center;
    }
    .bar {
      height: 6px;
      background: #333947;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 4px;
    }
    .bar-inner {
      height: 100%;
      background: #00b894;
      width: 50%;
      transition: width 0.3s;
    }

    .card {
      margin-top: 40px;
      background: #15171f;
      border-radius: 18px;
      padding: 20px 20px 24px;
      max-width: 480px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      box-sizing: border-box;
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    .avatar {
      width: 72px;
      height: 72px;
      border-radius: 16px;
      overflow: hidden;
      background: #2f3548;
      margin-right: 10px;
      flex-shrink: 0;
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .role {
      font-size: 14px;
      color: #c0c4d4;
    }
    .role-title {
      font-size: 12px;
      color: #8f93a6;
    }

    .text {
      font-size: 18px;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .choice-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .effect-hint {
      font-size: 12px;
      color: #9ba0b5;
    }
    .btn {
      padding: 11px 16px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      background: #262b3b;
      color: #f5f5f5;
    }
    .btn-left { text-align: left; }
    .btn-right { text-align: right; }
    .btn:active { transform: scale(0.97); }

    .end {
      text-align: center;
      margin-top: 24px;
      font-size: 15px;
      color: #ddd;
    }

    .controls {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .ctrl-btn {
      flex: 1;
      padding: 8px 10px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      background: #202432;
      color: #f5f5f5;
      cursor: pointer;
    }
    .ctrl-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }
  </style>
</head>
<body>

<div class="stats">
  <div class="stat">
    State
    <div class="bar"><div id="stateBar" class="bar-inner"></div></div>
  </div>
  <div class="stat">
    Society
    <div class="bar"><div id="societyBar" class="bar-inner"></div></div>
  </div>
  <div class="stat">
    Economy
    <div class="bar"><div id="economyBar" class="bar-inner"></div></div>
  </div>
  <div class="stat">
    Heaven
    <div class="bar"><div id="heavenBar" class="bar-inner"></div></div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <div class="avatar">
      <img id="avatarImg" src="" alt="portrait" />
    </div>
    <div>
      <div id="role" class="role"></div>
      <div id="roleTitle" class="role-title"></div>
    </div>
  </div>

  <div id="text" class="text"></div>

  <div id="choices" class="choices">
    <div class="choice-block">
      <div id="leftHint" class="effect-hint"></div>
      <button id="leftBtn" class="btn btn-left"></button>
    </div>
    <div class="choice-block" id="rightBlock">
      <div id="rightHint" class="effect-hint"></div>
      <button id="rightBtn" class="btn btn-right"></button>
    </div>
  </div>

  <div id="endText" class="end"></div>

  <div id="controlRow" class="controls">
    <button id="backBtn" class="ctrl-btn">◀ Back one decision</button>
    <button id="restartBtn" class="ctrl-btn">Restart scenario</button>
  </div>
</div>

<script>
  const THRESHOLD = 20;

  let stats = {
    state: 50,
    society: 50,
    economy: 50,
    heaven: 50
  };

  // 用于 Back：记录每一次选择前的状态
  let history = [];
  let inIntro = true;
  let inEnding = false;

  // 16 Qin cards with avatar images
  const cards = [
    {
      avatarSrc: "avatar-legalist.png",
      role: "Shang Yang",
      roleTitle: "Legalist Reformer",
      text: "My lord, Qin is weak because its laws are old. Grant me authority to implement strict reforms.",
      left: {
        label: "Enforce Legalist reforms.",
        effect: { state:+20, society:-10, economy:+10, heaven:-5 }
      },
      right: {
        label: "Keep old traditions.",
        effect: { state:-10, society:+10, economy:-5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-legalist.png",
      role: "Shang Yang",
      roleTitle: "Reformer",
      text: "The hereditary nobility resists reforms. Shall we abolish their ranks?",
      left: {
        label: "Abolish noble titles.",
        effect: { state:+15, society:-15, economy:+5, heaven:0 }
      },
      right: {
        label: "Preserve noble privileges.",
        effect: { state:-10, society:+10, economy:-5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-qin-king.png",
      role: "Qin Minister",
      roleTitle: "Internal Affairs",
      text: "To strengthen agriculture, we should relocate families to newly opened lands.",
      left: {
        label: "Force relocation.",
        effect: { state:+10, society:-15, economy:+10, heaven:-5 }
      },
      right: {
        label: "Allow voluntary migration.",
        effect: { state:-5, society:+10, economy:+5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-qin-general.png",
      role: "General Meng Ao",
      roleTitle: "Military Official",
      text: "Let military merit determine rank, not birth. The army will grow strong.",
      left: {
        label: "Approve merit-based ranks.",
        effect: { state:+20, society:-5, economy:-5, heaven:0 }
      },
      right: {
        label: "Reject military reform.",
        effect: { state:-10, society:+10, economy:+5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-han-envoy.png",
      role: "Ru Scholar",
      roleTitle: "Confucian Advisor",
      text: "A ruler wins hearts with benevolence. Lighten taxes, my lord.",
      left: {
        label: "Reduce taxes.",
        effect: { state:-10, society:+20, economy:-15, heaven:+5 }
      },
      right: {
        label: "Maintain high taxes.",
        effect: { state:+10, society:-10, economy:+10, heaven:-5 }
      }
    },
    {
      avatarSrc: "avatar-daoist.png",
      role: "Daoist Hermit",
      roleTitle: "Philosopher",
      text: "You rule too harshly. Let the realm breathe; punish less.",
      left: {
        label: "Ease punishments.",
        effect: { state:-15, society:+15, economy:-5, heaven:+10 }
      },
      right: {
        label: "Keep strict laws.",
        effect: { state:+15, society:-10, economy:+5, heaven:-5 }
      }
    },
    {
      avatarSrc: "avatar-priest.png",
      role: "Court Priest",
      roleTitle: "Yin–Yang Diviner",
      text: "Strange omens—stars shifting in the sky. A great ritual is needed.",
      left: {
        label: "Hold a grand ritual.",
        effect: { state:+5, society:+5, economy:-15, heaven:+20 }
      },
      right: {
        label: "Ignore omens.",
        effect: { state:+10, society:-10, economy:+10, heaven:-15 }
      }
    },
    {
      avatarSrc: "avatar-qin-general.png",
      role: "Border Officer",
      roleTitle: "Frontier Commander",
      text: "Han has built a new fortress on our border. Shall we attack?",
      left: {
        label: "Attack Han.",
        effect: { state:+15, society:-10, economy:-10, heaven:-5 }
      },
      right: {
        label: "Seek negotiation.",
        effect: { state:-5, society:+10, economy:+5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-legalist.png",
      role: "Han Feizi",
      roleTitle: "Legalist Thinker",
      text: "I bring ideas to perfect your rule. Should I stay in Qin?",
      left: {
        label: "Keep Han Feizi in Qin.",
        effect: { state:+20, society:-5, economy:+5, heaven:-5 }
      },
      right: {
        label: "Send him back to Han.",
        effect: { state:-10, society:+5, economy:0, heaven:+10 }
      }
    },
    {
      avatarSrc: "avatar-zhao-envoy.png",
      role: "Zhao Envoy",
      roleTitle: "Diplomat",
      text: "Join the vertical alliance (hezong) against Qin. Together we can resist superpowers.",
      left: {
        label: "Reject the alliance; trust Qin's own power.",
        effect: { state:+10, society:-5, economy:+5, heaven:0 }
      },
      right: {
        label: "Join the alliance.",
        effect: { state:-10, society:+10, economy:-5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-zhao-envoy.png",
      role: "Royal Matchmaker",
      roleTitle: "Diplomatic Affairs",
      text: "Zhao and Chu both offer princesses. Which alliance do we prefer?",
      left: {
        label: "Marry the Zhao princess.",
        effect: { state:+10, society:+10, economy:-5, heaven:+5 }
      },
      right: {
        label: "Marry the Chu princess.",
        effect: { state:+5, society:+15, economy:-10, heaven:0 }
      }
    },
    {
      avatarSrc: "avatar-qin-general.png",
      role: "General Bai Qi",
      roleTitle: "Commander",
      text: "Zhao is vulnerable. Strike now for complete victory.",
      left: {
        label: "Approve the attack.",
        effect: { state:+20, society:-15, economy:-10, heaven:-5 }
      },
      right: {
        label: "Hold the army back.",
        effect: { state:-10, society:+10, economy:+10, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-han-envoy.png",
      role: "Engineer Zheng Guo",
      roleTitle: "Hydraulics Specialist",
      text: "A canal will multiply Qin’s harvests—but costs are huge.",
      left: {
        label: "Build the canal.",
        effect: { state:+5, society:+5, economy:+20, heaven:+5 }
      },
      right: {
        label: "Reject the project.",
        effect: { state:+5, society:-5, economy:-10, heaven:0 }
      }
    },
    {
      avatarSrc: "avatar-legalist.png",
      role: "Li Si",
      roleTitle: "Chancellor",
      text: "Unify weights and measures before conquering the world.",
      left: {
        label: "Standardize systems.",
        effect: { state:+15, society:+5, economy:+10, heaven:0 }
      },
      right: {
        label: "Delay the reform.",
        effect: { state:-10, society:+5, economy:-5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-qin-general.png",
      role: "General Wang Jian",
      roleTitle: "Supreme Commander",
      text: "Qi stands alone. A swift strike will end the Warring States.",
      left: {
        label: "Launch the final campaign.",
        effect: { state:+20, society:-10, economy:-10, heaven:0 }
      },
      right: {
        label: "Delay the attack.",
        effect: { state:-5, society:+5, economy:+5, heaven:+5 }
      }
    },
    {
      avatarSrc: "avatar-legalist.png",
      role: "Li Si",
      roleTitle: "Chancellor",
      text: "After unification, you should adopt a new title—'First Emperor'.",
      left: {
        label: "Adopt the title 'First Emperor'.",
        effect: { state:+10, society:+5, economy:0, heaven:+10 }
      },
      right: {
        label: "Remain 'King of Qin'.",
        effect: { state:+5, society:0, economy:0, heaven:0 }
      }
    }
  ];

  let index = 0;

  function clamp(x) { return Math.max(0, Math.min(100, x)); }

  function updateBars() {
    document.getElementById("stateBar").style.width   = stats.state   + "%";
    document.getElementById("societyBar").style.width = stats.society + "%";
    document.getElementById("economyBar").style.width = stats.economy + "%";
    document.getElementById("heavenBar").style.width  = stats.heaven  + "%";
  }

  function formatEffect(effect) {
    const parts = [];
    function add(label, key) {
      const v = effect[key] || 0;
      if (v === 0) return;
      const sign = v > 0 ? "+" + v : v;
      parts.push(label + " " + sign);
    }
    add("State", "state");
    add("Society", "society");
    add("Economy", "economy");
    add("Heaven", "heaven");
    return parts.join(" · ");
  }

  function setBackEnabled() {
    const backBtn = document.getElementById("backBtn");
    backBtn.disabled = (history.length === 0 || inIntro || inEnding);
  }

  function showEnding(ending) {
    const choicesDiv = document.getElementById("choices");
    const rightBlock = document.getElementById("rightBlock");
    const restartBtn = document.getElementById("restartBtn");

    inEnding = true;
    choicesDiv.style.display = "none";
    rightBlock.style.display = "none";

    document.getElementById("avatarImg").src = ending.avatarSrc || "";
    document.getElementById("role").textContent = ending.role;
    document.getElementById("roleTitle").textContent = ending.roleTitle;
    document.getElementById("text").textContent = ending.text;

    const summary =
      "Final stats — State " + stats.state +
      ", Society " + stats.society +
      ", Economy " + stats.economy +
      ", Heaven " + stats.heaven + ".";

    document.getElementById("endText").textContent =
      (ending.extra || "") + (ending.extra ? " " : "") + summary;

    restartBtn.style.display = "block";
    setBackEnabled();
  }

  function checkEnd() {
    if (stats.state < THRESHOLD) {
      showEnding({
        avatarSrc: "avatar-qin-king.png",
        role: "Coup at Court",
        roleTitle: "State power collapses",
        text: "Your authority fades. Powerful clans seize the court and place another on the throne."
      });
      return true;
    }
    if (stats.society < THRESHOLD) {
      showEnding({
        avatarSrc: "avatar-han-envoy.png",
        role: "Popular Uprising",
        roleTitle: "Society in chaos",
        text: "Harsh rule and resentment ignite a massive uprising. Qin burns from within."
      });
      return true;
    }
    if (stats.economy < THRESHOLD) {
      showEnding({
        avatarSrc: "avatar-priest.png",
        role: "Famine and Disorder",
        roleTitle: "Economy collapses",
        text: "Harvests fail and the granaries are empty. Famine leads to riots and the state collapses."
      });
      return true;
    }
    if (stats.heaven < THRESHOLD) {
      showEnding({
        avatarSrc: "avatar-zhao-envoy.png",
        role: "Punished by Heaven",
        roleTitle: "Mandate withdrawn",
        text: "Omens darken the sky. The Zhou Son of Heaven condemns you and allied states invade Qin."
      });
      return true;
    }
    return false;
  }

  function showCard() {
    const choicesDiv = document.getElementById("choices");
    const rightBlock = document.getElementById("rightBlock");
    const restartBtn = document.getElementById("restartBtn");

    inIntro = false;
    inEnding = false;

    choicesDiv.style.display = "flex";
    rightBlock.style.display = "flex";
    restartBtn.style.display = "none";

    if (index >= cards.length) {
      const good =
        stats.state  >= THRESHOLD &&
        stats.society>= THRESHOLD &&
        stats.economy>= THRESHOLD &&
        stats.heaven >= THRESHOLD;

      if (good) {
        showEnding({
          avatarSrc: "avatar-first-emperor.png",
          role: "First Emperor of Qin",
          roleTitle: "Unifier of All Under Heaven",
          text: "Through careful balance of power, people, wealth, and Heaven, you have conquered all six states.",
          extra: "Qin stands united. You become the First Emperor."
        });
      } else {
        showEnding({
          avatarSrc: "avatar-qin-king.png",
          role: "The Qin Court",
          roleTitle: "An unfinished empire",
          text: "Your Qin survives, but without enough strength or legitimacy to unify the six states.",
          extra: "Look at your four stats and explain why your version of Qin failed to unify."
        });
      }
      setBackEnabled();
      return;
    }

    const c = cards[index];
    document.getElementById("avatarImg").src = c.avatarSrc || "";
    document.getElementById("role").textContent = c.role;
    document.getElementById("roleTitle").textContent = c.roleTitle || "";
    document.getElementById("text").textContent = c.text;

    document.getElementById("leftBtn").textContent = "◀ " + c.left.label;
    document.getElementById("rightBtn").textContent = c.right.label + " ▶";

    document.getElementById("leftHint").textContent =
      "Effect: " + formatEffect(c.left.effect);
    document.getElementById("rightHint").textContent =
      "Effect: " + formatEffect(c.right.effect);

    document.getElementById("endText").textContent = "";
    document.getElementById("leftBtn").disabled = false;
    document.getElementById("rightBtn").disabled = false;

    setBackEnabled();
  }

  function applyChoice(choice) {
    const eff = choice.effect || {};
    // 记录历史，用于 Back
    history.push({
      index: index,
      stats: { ...stats }
    });

    stats.state   = clamp(stats.state   + (eff.state   || 0));
    stats.society = clamp(stats.society + (eff.society || 0));
    stats.economy = clamp(stats.economy + (eff.economy || 0));
    stats.heaven  = clamp(stats.heaven  + (eff.heaven  || 0));
    updateBars();

    if (!checkEnd()) {
      index++;
      showCard();
    }
  }

  function showIntro() {
    const choicesDiv = document.getElementById("choices");
    const rightBlock = document.getElementById("rightBlock");
    const restartBtn = document.getElementById("restartBtn");

    inIntro = true;
    inEnding = false;
    history = [];

    // 初始数值
    stats = { state: 50, society: 50, economy: 50, heaven: 50 };
    updateBars();

    document.getElementById("avatarImg").src = "avatar-qin-king.png";
    document.getElementById("role").textContent = "Background: Qin in the Warring States";
    document.getElementById("roleTitle").textContent = "Zhou king, seven major states, and you";

    document.getElementById("text").textContent =
      "It is the Warring States period. The Zhou king is a distant ritual overlord, while seven major states—Qin, Chu, Qi, Yan, Han, Zhao, and Wei—compete for real power. Qin lies in the west on the frontier. As ruler of Qin, you must balance State power, Society, Economy, and Heaven. If any falls too low, Qin will collapse before unification.";

    document.getElementById("leftBtn").textContent = "Start the scenario";
    document.getElementById("leftHint").textContent =
      "You will face sixteen key decisions from early reforms to the unification of the six states.";
    document.getElementById("rightBtn").textContent = "";
    document.getElementById("rightHint").textContent = "";

    choicesDiv.style.display = "flex";
    rightBlock.style.display = "none"; // 只留一个按钮
    restartBtn.style.display = "none";

    document.getElementById("endText").textContent =
      "How to play: each decision changes the four stats. Try to keep them all above 20 while steering Qin toward unification.";

    setBackEnabled();
  }

  function startScenario() {
    history = [];
    stats = { state: 50, society: 50, economy: 50, heaven: 50 };
    updateBars();
    index = 0;
    showCard();
  }

  document.getElementById("leftBtn").addEventListener("click", () => {
    if (inIntro) {
      startScenario();
    } else if (!inEnding) {
      applyChoice(cards[index].left);
    }
  });

  document.getElementById("rightBtn").addEventListener("click", () => {
    if (!inIntro && !inEnding) {
      applyChoice(cards[index].right);
    }
  });

  document.getElementById("backBtn").addEventListener("click", () => {
    if (history.length === 0 || inIntro || inEnding) return;
    const last = history.pop();
    stats = { ...last.stats };
    index = last.index;
    updateBars();
    showCard();
  });

  document.getElementById("restartBtn").addEventListener("click", () => {
    showIntro();
  });

  // 初始化：先显示历史背景页
  showIntro();
</script>

</body>
</html>


